package {{.Package}}

import (
	"context"

	"github.com/containers/kubernetes-mcp-server/pkg/api"
	internalk8s "github.com/containers/kubernetes-mcp-server/pkg/kubernetes"
	"github.com/containers/kubernetes-mcp-server/pkg/toolsets"
)

// {{.CRD.Kind}}Toolset provides MCP tools for managing {{.CRD.Kind}} custom resources
type {{.CRD.Kind}}Toolset struct{}

// Ensure {{.CRD.Kind}}Toolset implements api.Toolset and api.ResourceProvider interfaces
var _ api.Toolset = (*{{.CRD.Kind}}Toolset)(nil)
var _ api.ResourceProvider = (*{{.CRD.Kind}}Toolset)(nil)

// GetName returns the name of this toolset
func (t *{{.CRD.Kind}}Toolset) GetName() string {
	return "{{.Toolset.GetToolsetName}}"
}

// GetDescription returns the description of this toolset
func (t *{{.CRD.Kind}}Toolset) GetDescription() string {
	return "{{.Toolset.GetToolsetDescription}}"
}

// GetTools returns all MCP tools provided by this toolset
func (t *{{.CRD.Kind}}Toolset) GetTools(o internalk8s.Openshift) []api.ServerTool {
	return []api.ServerTool{
		{{- range $operation := .Operations}}
		{{generateMethodName $operation $.CRD.Plural | ToLower}}Tool(),
		{{- end}}
	}
}

// RegisterResources registers MCP resources for this toolset
func (t *{{.CRD.Kind}}Toolset) RegisterResources(registerFunc func(uri, name, mimeType string, handler func(context.Context) (string, error)) error) error {
	return registerFunc(
		"crd://{{.CRD.Group}}/{{.CRD.Version}}/{{.CRD.Kind}}",
		"{{.CRD.Kind}} {{.CRD.Version}} CRD",
		"text/yaml",
		func(_ context.Context) (string, error) {
			return embedded{{.CRD.Kind}}CRDYAML, nil
		},
	)
}

// embedded{{.CRD.Kind}}CRDYAML contains the complete CRD YAML definition
const embedded{{.CRD.Kind}}CRDYAML = `{{.CRD.YAMLContent}}`

{{range $operation := .Operations}}
// {{generateMethodName $operation $.CRD.Plural | ToLower}}Tool creates the MCP tool for {{$operation}} operations
func {{generateMethodName $operation $.CRD.Plural | ToLower}}Tool() api.ServerTool {
	return api.ServerTool{
		Tool: api.Tool{
			Name:        "{{generateToolName $operation $.CRD.Plural}}",
			Description: "{{$operation | ToTitle}} a {{$.CRD.Kind}} custom resource",
			InputSchema: {{$operation}}{{$.CRD.Kind}}Schema(),
		},
		Handler: Handle{{$operation | ToTitle}}{{$.CRD.Kind}},
	}
}

{{end}}

// init registers this toolset with the global registry
func init() {
	toolsets.Register(&{{.CRD.Kind}}Toolset{})
}