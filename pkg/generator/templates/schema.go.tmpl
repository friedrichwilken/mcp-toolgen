package {{.Package}}

import (
	"github.com/google/jsonschema-go/jsonschema"
)

{{range $operation := .Operations}}
{{if $.IncludeComments}}
// {{$operation}}{{$.CRD.Kind}}Schema returns the JSON schema for {{$operation}} {{$.CRD.Kind}} operations
{{end}}
func {{$operation}}{{$.CRD.Kind}}Schema() *jsonschema.Schema {
	{{if eq $operation "create"}}
	return &jsonschema.Schema{
		Type: "object",
		Properties: map[string]*jsonschema.Schema{
			"namespace": {
				Type:        "string",
				Description: "Kubernetes namespace (optional, defaults to 'default')",
			},
			"cluster": {
				Type:        "string",
				Description: "Target cluster name (optional, uses default cluster if not specified)",
			},
			"args": {
				Type:        "object",
				Description: "{{$.CRD.Kind}} resource specification",
				Properties: map[string]*jsonschema.Schema{
					"metadata": {
						Type: "object",
						Properties: map[string]*jsonschema.Schema{
							"name": {
								Type:        "string",
								Description: "Name of the {{$.CRD.Kind}}",
							},
							"namespace": {
								Type:        "string",
								Description: "Namespace of the {{$.CRD.Kind}}",
							},
							"labels": {
								Type:        "object",
								Description: "Labels for the {{$.CRD.Kind}}",
							},
							"annotations": {
								Type:        "object",
								Description: "Annotations for the {{$.CRD.Kind}}",
							},
						},
						Required: []string{"name"},
					},
					{{if $.SpecType}}
					{{if index $.CRD.Schema.Properties "spec"}}
					"spec": {{ConvertSchemaToGoCode (index $.CRD.Schema.Properties "spec") 5}},
					{{else}}
					"spec": {
						Type:        "object",
						Description: "{{$.CRD.Kind}} specification",
					},
					{{end}}
					{{end}}
				},
				Required: []string{"metadata"},
			},
		},
		Required: []string{"args"},
	}
	{{else if eq $operation "get"}}
	return &jsonschema.Schema{
		Type: "object",
		Properties: map[string]*jsonschema.Schema{
			"name": {
				Type:        "string",
				Description: "Name of the {{$.CRD.Kind}} to retrieve",
			},
			"namespace": {
				Type:        "string",
				Description: "Kubernetes namespace (optional, defaults to 'default')",
			},
			"cluster": {
				Type:        "string",
				Description: "Target cluster name (optional, uses default cluster if not specified)",
			},
		},
		Required: []string{"name"},
	}
	{{else if eq $operation "list"}}
	return &jsonschema.Schema{
		Type: "object",
		Properties: map[string]*jsonschema.Schema{
			"namespace": {
				Type:        "string",
				Description: "Kubernetes namespace to list from (optional, defaults to 'default')",
			},
			"cluster": {
				Type:        "string",
				Description: "Target cluster name (optional, uses default cluster if not specified)",
			},
			"labelSelector": {
				Type:        "string",
				Description: "Label selector to filter {{$.CRD.Kind}} resources (optional)",
			},
		},
	}
	{{else if eq $operation "update"}}
	return &jsonschema.Schema{
		Type: "object",
		Properties: map[string]*jsonschema.Schema{
			"namespace": {
				Type:        "string",
				Description: "Kubernetes namespace (optional, defaults to 'default')",
			},
			"cluster": {
				Type:        "string",
				Description: "Target cluster name (optional, uses default cluster if not specified)",
			},
			"args": {
				Type:        "object",
				Description: "{{$.CRD.Kind}} resource specification",
				Properties: map[string]*jsonschema.Schema{
					"metadata": {
						Type: "object",
						Properties: map[string]*jsonschema.Schema{
							"name": {
								Type:        "string",
								Description: "Name of the {{$.CRD.Kind}}",
							},
							"namespace": {
								Type:        "string",
								Description: "Namespace of the {{$.CRD.Kind}}",
							},
							"labels": {
								Type:        "object",
								Description: "Labels for the {{$.CRD.Kind}}",
							},
							"annotations": {
								Type:        "object",
								Description: "Annotations for the {{$.CRD.Kind}}",
							},
							"resourceVersion": {
								Type:        "string",
								Description: "Resource version for optimistic concurrency",
							},
						},
						Required: []string{"name"},
					},
					{{if $.SpecType}}
					{{if index $.CRD.Schema.Properties "spec"}}
					"spec": {{ConvertSchemaToGoCode (index $.CRD.Schema.Properties "spec") 5}},
					{{else}}
					"spec": {
						Type:        "object",
						Description: "{{$.CRD.Kind}} specification",
					},
					{{end}}
					{{end}}
				},
				Required: []string{"metadata"},
			},
		},
		Required: []string{"args"},
	}
	{{else if eq $operation "delete"}}
	return &jsonschema.Schema{
		Type: "object",
		Properties: map[string]*jsonschema.Schema{
			"name": {
				Type:        "string",
				Description: "Name of the {{$.CRD.Kind}} to delete",
			},
			"namespace": {
				Type:        "string",
				Description: "Kubernetes namespace (optional, defaults to 'default')",
			},
			"cluster": {
				Type:        "string",
				Description: "Target cluster name (optional, uses default cluster if not specified)",
			},
			"gracePeriodSeconds": {
				Type:        "integer",
				Description: "Grace period for deletion (optional)",
				Minimum:     float64Ptr(0),
			},
		},
		Required: []string{"name"},
	}
	{{end}}
}

{{end}}

{{if .IncludeComments}}
// Common schema definitions
{{end}}

{{if .IncludeComments}}
// metadataSchema returns the common metadata schema
{{end}}
func metadataSchema() *jsonschema.Schema {
	return &jsonschema.Schema{
		Type: "object",
		Properties: map[string]*jsonschema.Schema{
			"name": {
				Type:        "string",
				Description: "Name of the resource",
			},
			"namespace": {
				Type:        "string",
				Description: "Namespace of the resource",
			},
			"labels": {
				Type:        "object",
				Description: "Labels for the resource",
			},
			"annotations": {
				Type:        "object",
				Description: "Annotations for the resource",
			},
		},
		Required: []string{"name"},
	}
}

{{if .SpecType}}
{{if .IncludeComments}}
// {{.CRD.Kind | ToLower}}SpecSchema returns the schema for {{.CRD.Kind}} spec
{{end}}
func {{.CRD.Kind | ToLower}}SpecSchema() *jsonschema.Schema {
	return &jsonschema.Schema{
		Type:        "object",
		Description: "{{.CRD.Kind}} specification",
		Properties: map[string]*jsonschema.Schema{
			{{range $field := .SpecType.GetStructFields}}
			"{{$field.JSONName}}": {
				{{if $field.IsPrimitiveType}}
				Type:        "{{$field.GoType}}",
				{{else if $field.IsArrayType}}
				Type:        "array",
				Items:       &jsonschema.Schema{Type: "object"},
				{{else}}
				Type:        "object",
				{{end}}
				{{if $field.Description}}
				Description: "{{EscapeString $field.Description}}",
				{{end}}
			},
			{{end}}
		},
		{{if .IncludeComments}}
		// Add required fields based on CRD schema
		{{end}}
	}
}
{{end}}

{{if .StatusType}}
{{if .IncludeComments}}
// {{.CRD.Kind | ToLower}}StatusSchema returns the schema for {{.CRD.Kind}} status
{{end}}
func {{.CRD.Kind | ToLower}}StatusSchema() *jsonschema.Schema {
	return &jsonschema.Schema{
		Type:        "object",
		Description: "{{.CRD.Kind}} status",
		Properties: map[string]*jsonschema.Schema{
			{{range $field := .StatusType.GetStructFields}}
			"{{$field.JSONName}}": {
				{{if $field.IsPrimitiveType}}
				Type:        "{{$field.GoType}}",
				{{else if $field.IsArrayType}}
				Type:        "array",
				Items:       &jsonschema.Schema{Type: "object"},
				{{else}}
				Type:        "object",
				{{end}}
				{{if $field.Description}}
				Description: "{{EscapeString $field.Description}}",
				{{end}}
			},
			{{end}}
		},
	}
}
{{end}}

// float64Ptr returns a pointer to a float64 value
func float64Ptr(v float64) *float64 {
	return &v
}